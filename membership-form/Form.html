<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Farmer Registration Form</title>
      <link rel="stylesheet" href="style.css" />
   </head>

   <body>
      <div class="site-nav-placeholder" data-current="farmer" data-folder="membership-form"></div>
      <script src="../nav.js"></script>
      <div class="toolbar">
         <button class="btn" type="button" onclick="window.print()">
            Print
         </button>
         <button class="btn" type="button" id="generate-pdf-btn">
            Generate PDF
         </button>
         <button class="btn secondary" type="button" id="save-draft-btn">
            Save draft
         </button>
         <button
            class="btn secondary"
            type="button"
            onclick="document.getElementById('form').reset()">
            Reset
         </button>
      </div>

      <div class="sheet">
         <form id="form">
            <div class="form-header">
               <h1>FARMER APPLICATION FOR COOPERATIVE MEMBERSHIP</h1><br>
               <div class="section-header">Personal Information</div>
            </div>

            <div class="grid">
               <div class="c4">
                  <label>Surname</label>
                  <input type="text" />
               </div>
               <div class="c4">
                  <label>First Name</label>
                  <input type="text" />
               </div>
               <div class="c4">
                  <label>Middle name</label>
                  <input type="text" />
               </div>
               <div class="c3">
                  <label>Gender</label>
                  <div class="checks" style="padding-top: 6px">
                     <label><input type="radio" name="gender" /> Male</label>
                     <label><input type="radio" name="gender" /> Female</label>
                  </div>
               </div>
               <div class="c3">
                  <label>Date of Birth (mm/dd/yyyy)</label>
                  <input type="date" />
               </div>
               <div class="c6">
                  <label>Marital Status</label>
                  <div class="checks" style="padding-top: 6px">
                     <label><input type="radio" name="marital" /> Single</label>
                     <label
                        ><input type="radio" name="marital" /> Married</label
                     >
                     <label
                        ><input type="radio" name="marital" /> Widowed</label
                     >
                  </div>
               </div>
               <div class="c6">
                  <label>Name of Spouse</label>
                  <input type="text" />
               </div>

               <div class="f">
                  <label>Present Address</label>
                  <input type="text" />
               </div>
               <div class="f">
                  <label>Permanent Address</label>
                  <input type="text" />
               </div>

               <div class="c4">
                  <label>Mobile Number</label>
                  <input type="tel" />
               </div>
               <div class="c4">
                  <label>Home Phone Number</label>
                  <input type="tel" />
               </div>
               <div class="c4">
                  <label>Government ID No. (SSS/GSIS/PhilHealth)</label>
                  <input type="text" />
               </div>

               <div class="c6">
                  <label>Bank Account No. (if any)</label>
                  <input type="text" />
               </div>
               <div class="c6">
                  <label>Email Address</label>
                  <input type="email" />
               </div>
            </div>

            <div class="section-header">Farm / Livelihood Information</div>
            <div class="grid">
               <div class="c4">
                  <label>Barangay / Sitio</label>
                  <input type="text" />
               </div>
               <div class="c4">
                  <label>Farm / Location Address</label>
                  <input type="text" />
               </div>
               <div class="c4">
                  <label>Land area (e.g. sq.m / hectare)</label>
                  <input type="text" />
               </div>
               <div class="f">
                  <label>Main livelihood</label>
                  <div class="checks" style="padding-top: 4px">
                     <label><input type="checkbox" /> Crops</label>
                     <label><input type="checkbox" /> Livestock</label>
                     <label><input type="checkbox" /> Poultry</label>
                     <label><input type="checkbox" /> Fishing</label>
                     <label><input type="checkbox" /> Mixed</label>
                  </div>
               </div>
               <div class="f">
                  <label>Land tenure</label>
                  <div class="checks" style="padding-top: 4px">
                     <label><input type="checkbox" /> Owned</label>
                     <label><input type="checkbox" /> Leased</label>
                     <label><input type="checkbox" /> Communal</label>
                     <label><input type="checkbox" /> Other</label>
                  </div>
               </div>
            </div>

            <div class="section-header">Application Type</div>
            <div class="grid grid-center">
               <div class="f checks">
                  <label
                     ><input type="checkbox" name="apptype" /> New Member</label
                  >
                  <label
                     ><input type="checkbox" name="apptype" />
                     Re-Activate</label
                  >
                  <label
                     ><input type="checkbox" name="apptype" /> Update
                     Records</label
                  >
               </div>
               <div class="c6">
                  <label>Transfer From</label>
                  <input type="text" />
               </div>
               <div class="c6">
                  <label>Transfer To</label>
                  <input type="text" />
               </div>
            </div>

            <div class="section-header">
               Beneficiaries (Surname, First name, Middle name)
            </div>
            <table>
               <thead>
                  <tr>
                     <th style="width: 24px">#</th>
                     <th>Fullname (Last, First, Middle)</th>
                     <th style="width: 100px">Date of Birth (mm/dd/yyyy)</th>
                     <th style="width: 100px">Relationship</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <td>1</td>
                     <td><input type="text" /></td>
                     <td><input type="date" /></td>
                     <td><input type="text" /></td>
                  </tr>
                  <tr>
                     <td>2</td>
                     <td><input type="text" /></td>
                     <td><input type="date" /></td>
                     <td><input type="text" /></td>
                  </tr>
                  <tr>
                     <td>3</td>
                     <td><input type="text" /></td>
                     <td><input type="date" /></td>
                     <td><input type="text" /></td>
                  </tr>
               </tbody>
            </table>
            <div class="note muted">
               <em
                  >If no beneficiaries nominated, the Cooperative will follow
                  legal heirs per hierarchy rule: spouse for married, parents
                  for single.</em
               >
            </div>

            <div class="section-header">Agreement</div>
            <div class="note">
               I declare that the information above is correct. I have read and
               understood the policies and rules of the Cooperative and agree to
               its terms and conditions. I consent to the use of my data per the
               Cooperativeâ€™s Data Privacy Policy.
            </div>
            <div class="sigrow">
               <div>
                  <label>Signature over Printed Name</label>
                  <input type="text" />
               </div>
               <div>
                  <label>Date (mm/dd/yyyy)</label>
                  <input type="date" />
               </div>
            </div>

            <div class="section-header">
               Coop Approval (For Office Use Only)
            </div>
            <div class="grid">
               <div class="c4">
                  <label>Registration ID No.</label>
                  <input type="text" />
               </div>
               <div class="c4">
                  <label>Date Approved (mm/dd/yyyy)</label>
                  <input type="date" />
               </div>
               <div class="c4">
                  <label>Received by</label>
                  <input type="text" />
               </div>
            </div>
         </form>
      </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
      <style>
         .pdf-value {
            display: block;
            width: 100%;
            min-height: 20px;
            border: none;
            border-bottom: 1px solid #999;
            font-size: 11px;
            padding: 3px 2px 2px;
            font-family: Arial, Helvetica, sans-serif;
            background: transparent;
            box-sizing: border-box;
         }
         .sheet td .pdf-value { display: block; width: 100%; }
         .pdf-checkbox {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 1px solid #000;
            vertical-align: middle;
            text-align: center;
            line-height: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 4px;
         }
      </style>
      <script>
         (function () {
            var STORAGE_KEY = 'farmer-form-draft';
            var form = document.getElementById('form');

            function saveFormDraft() {
               if (!form) return;
               var inputs = form.querySelectorAll('input');
               var data = { count: inputs.length, fields: [] };
               inputs.forEach(function (input) {
                  var type = (input.type || 'text').toLowerCase();
                  data.fields.push({
                     value: input.value || '',
                     checked: type === 'checkbox' || type === 'radio' ? input.checked : false
                  });
               });
               try { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); } catch (e) {}
            }

            function loadFormDraft() {
               if (!form) return;
               try {
                  var raw = localStorage.getItem(STORAGE_KEY);
                  if (!raw) return;
                  var data = JSON.parse(raw);
                  var inputs = form.querySelectorAll('input');
                  if (data.fields && data.fields.length === inputs.length) {
                     data.fields.forEach(function (f, i) {
                        inputs[i].value = f.value != null ? f.value : '';
                        if (inputs[i].type === 'checkbox' || inputs[i].type === 'radio') {
                           inputs[i].checked = !!f.checked;
                        }
                     });
                  }
               } catch (e) {}
            }

            loadFormDraft();
            window.addEventListener('beforeprint', saveFormDraft);
            document.getElementById('generate-pdf-btn').addEventListener('click', saveFormDraft);
            document.getElementById('save-draft-btn').addEventListener('click', function () {
               saveFormDraft();
               var btn = document.getElementById('save-draft-btn');
               var t = btn.textContent;
               btn.textContent = 'Saved';
               setTimeout(function () { btn.textContent = t; }, 1500);
            });
            form.addEventListener('reset', function () {
               try { localStorage.removeItem(STORAGE_KEY); } catch (e) {}
            });
         })();
      </script>
      <script>
         document.getElementById('generate-pdf-btn').addEventListener('click', function () {
            var sheet = document.querySelector('.sheet');
            if (!sheet) return;
            function formatDate(val) {
               if (!val) return '';
               var d = new Date(val);
               var m = '' + (d.getMonth() + 1), day = '' + d.getDate(), y = d.getFullYear();
               if (m.length < 2) m = '0' + m;
               if (day.length < 2) day = '0' + day;
               return m + '/' + day + '/' + y;
            }
            var restores = [];
            sheet.querySelectorAll('input').forEach(function (input) {
               var type = (input.type || 'text').toLowerCase();
               var parent = input.parentNode;
               if (type === 'checkbox' || type === 'radio') {
                  var span = document.createElement('span');
                  span.className = 'pdf-checkbox';
                  span.textContent = input.checked ? '\u2713' : '';
                  parent.replaceChild(span, input);
                  restores.push({ parent: parent, input: input, span: span });
               } else {
                  var span = document.createElement('span');
                  span.className = 'pdf-value';
                  var val = input.value || '';
                  if (type === 'date' && val) val = formatDate(val);
                  span.textContent = val;
                  parent.replaceChild(span, input);
                  restores.push({ parent: parent, input: input, span: span });
               }
            });
            function restore() {
               restores.forEach(function (r) {
                  if (r.span.parentNode) {
                     r.parent.replaceChild(r.input, r.span);
                  }
               });
            }
            html2canvas(sheet, {
               scale: 2,
               useCORS: true,
               logging: false,
               scrollX: 0,
               scrollY: 0
            }).then(function (canvas) {
               var imgData = canvas.toDataURL('image/jpeg', 0.95);
               var pdf = new jspdf.jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
               var pageW = pdf.internal.pageSize.getWidth();
               var pageH = pdf.internal.pageSize.getHeight();
               var margin = 5;
               var fitW = pageW - 2 * margin;
               var fitH = pageH - 2 * margin;
               var imgW = canvas.width;
               var imgH = canvas.height;
               var aspect = imgH / imgW;
               var drawW = fitW;
               var drawH = fitW * aspect;
               if (drawH > fitH) {
                  drawH = fitH;
                  drawW = fitH / aspect;
               }
               var x = margin + (fitW - drawW) / 2;
               var y = margin + (fitH - drawH) / 2;
               pdf.addImage(imgData, 'JPEG', x, y, drawW, drawH);
               pdf.save('farmer-application.pdf');
               restore();
            }).catch(function () {
               restore();
            });
         });
      </script>
      <script>
         (function () {
            var dateInputs = document.querySelectorAll('input[type="date"]');
            function formatDateForPrint(value) {
               if (!value) return '';
               var d = new Date(value);
               var m = '' + (d.getMonth() + 1), day = '' + d.getDate(), y = d.getFullYear();
               if (m.length < 2) m = '0' + m;
               if (day.length < 2) day = '0' + day;
               return m + '/' + day + '/' + y;
            }
            window.addEventListener('beforeprint', function () {
               dateInputs.forEach(function (input) {
               input._savedType = 'date';
               input._savedValue = input.value || '';
               input.type = 'text';
               input.value = input._savedValue ? formatDateForPrint(input._savedValue) : '';
            });
            });
            window.addEventListener('afterprint', function () {
               dateInputs.forEach(function (input) {
               input.type = input._savedType || 'date';
               input.value = input._savedValue || '';
               delete input._savedType;
               delete input._savedValue;
            });
            });
         })();
      </script>
      <footer class="site-credits">
         <p class="site-credits-dev">Developed by ALEX OLESCO</p>
         <p class="site-credits-contact">For website development, contact <a href="https://www.facebook.com/alexolesco" target="_blank" rel="noopener noreferrer">ALEX OLESCO on Facebook</a></p>
      </footer>
   </body>
</html>
